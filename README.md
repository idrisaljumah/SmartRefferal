Clinical Referral Generator PWA

Offline-First Progressive Web App for Clinical Referral Generation with On-Device AI

[ (https://img.shields.io/badge/License-MIT-blue.svg)](https://img.shields.io/badge/License-MIT-blue.svg "url-only") $$(LICENSE)\ $$![PWA](https://img.shields.io/badge/PWA-Ready-brightgreen.svg) [ (https://img.shields.io/badge/PWA-Ready-brightgreen.svg)](https://img.shields.io/badge/PWA-Ready-brightgreen.svg "url-only") $$([https://web.dev/progressive-web-apps/](https://web.dev/progressive-web-apps/))\ $$![TypeScript](https://img.shields.io/badge/TypeScript-5.3-blue.svg) [ (https://img.shields.io/badge/TypeScript-5.3-blue.svg)](https://img.shields.io/badge/TypeScript-5.3-blue.svg "url-only") $$([https://www.typescriptlang.org/](https://www.typescriptlang.org/)) --- ## üéØ Overview A production-ready Progressive Web App that generates specialty-specific clinical referral notes **entirely offline** using on-device AI models. No server required, no PHI leaves the device. ### Key Features ‚úÖ **Fully Offline** - Works without internet after initial install\ ‚úÖ **On-Device AI** - WebAssembly-based LLM and STT models\ ‚úÖ **Zero Download Prompts** - Models auto-fetch in background\ ‚úÖ **Encrypted Storage** - All PHI encrypted at rest (AES-GCM)\ ‚úÖ **Multilingual** - English + Arabic (RTL) support\ ‚úÖ **Voice Input** - Speech-to-text for hands-free dictation\ ‚úÖ **Export Options** - PDF and FHIR ReferralRequest formats\ ‚úÖ **Progressive Enhancement** - Graceful degradation on low-end devices --- ## üèóÔ∏è Architecture ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ React UI (TypeScript) ‚îÇ ‚îÇ ‚îú‚îÄ Input (Text/Voice) ‚Üí Generate ‚Üí Review ‚Üí Export ‚îÇ ‚îÇ ‚îî‚îÄ Model Status Dashboard ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ Model Manager ‚îÇ ‚îÇ ‚îú‚îÄ Capability Detection ‚îÇ ‚îÇ ‚îú‚îÄ Seed Model (bundled, ‚â§50MB) ‚îÇ ‚îÇ ‚îú‚îÄ Background Fetch (high-accuracy models) ‚îÇ ‚îÇ ‚îî‚îÄ Integrity Verification (SHA256) ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ WASM Runtime ‚îÇ ‚îÇ ‚îú‚îÄ llama.cpp (LLM inference) ‚îÇ ‚îÇ ‚îú‚îÄ whisper.cpp (STT) ‚îÇ ‚îÇ ‚îî‚îÄ WebGPU acceleration (when available) ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ Storage Layer (IndexedDB + Web Crypto) ‚îÇ ‚îÇ ‚îú‚îÄ Encrypted referrals ‚îÇ ‚îÇ ‚îú‚îÄ Model blobs (chunked) ‚îÇ ‚îÇ ‚îî‚îÄ Download progress ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ Service Worker (Workbox) ‚îÇ ‚îÇ ‚îú‚îÄ Precache app shell + seed models ‚îÇ ‚îÇ ‚îú‚îÄ Runtime caching (models, assets) ‚îÇ ‚îÇ ‚îî‚îÄ Background sync (optional) ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` --- ## üöÄ Quick Start ### Prerequisites * Node.js 18+ * npm or yarn * HTTPS-enabled domain (for PWA features) ### Installation ```bash # Clone repository git clone https://github.com/your-org/clinical-referral-pwa.git cd clinical-referral-pwa # Install dependencies npm install # Run development server npm run dev ``` Visit `http://localhost:5173` (or your configured port) ### Build for Production ```bash # Verify model licenses npm run verify-models # Build optimized bundle npm run build # Preview production build npm run preview ``` --- ## üì¶ Model Setup ### Option 1: Use Mock Models (Demo) The scaffold includes mock WASM implementations for immediate testing. No additional setup required. ### Option 2: Integrate Real Models (Production) #### Step 1: Obtain Models **LLM (Seed Model)** ```bash # Download TinyLlama (Apache-2.0 license) wget https://huggingface.co/TheBloke/TinyLlama-1.1B-Chat-v1.0-GGUF/resolve/main/tinyllama-1.1b-chat-v1.0.Q8_0.gguf # Move to public directory mv tinyllama-1.1b-chat-v1.0.Q8_0.gguf public/models/llm-seed-q8.gguf ``` **STT (Seed Model)** ```bash # Download Whisper Tiny wget https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-tiny.bin # Move to public directory mv ggml-tiny.bin public/models/stt-whisper-tiny.bin ``` #### Step 2: Compute Checksums ```bash sha256sum public/models/*.gguf public/models/*.bin ``` #### Step 3: Update Manifest Edit `src/lib/model-manager.ts` and update the `DEFAULT_MANIFEST` with actual checksums: ```typescript checksum: 'abc123...' // Replace with actual SHA256 ``` #### Step 4: Integrate WASM Runtime See [DEPLOYMENT.md](DEPLOYMENT.md) for detailed instructions on building and integrating llama.cpp and whisper.cpp WASM modules. --- ## üß™ Testing ### Device Testing Test on a range of devices to ensure compatibility: * **Desktop**: Chrome, Firefox, Edge, Safari * **Mobile**: Chrome (Android), Safari (iOS) * **Low-end**: 2GB RAM Android device * **High-end**: 8GB+ RAM device with WebGPU ### Offline Testing 1. Open app in browser 2. Open DevTools ‚Üí Application ‚Üí Service Workers 3. Check "Offline" mode 4. Verify all features work without network ### Performance Testing ```bash # Run Lighthouse audit npx lighthouse http://localhost:5173 --view # Check bundle size npm run build npx vite-bundle-visualizer ``` --- ## üì± PWA Installation ### Desktop (Chrome/Edge) 1. Visit app URL 2. Click install icon in address bar 3. Click "Install" ### Mobile (Android) 1. Visit app URL in Chrome 2. Tap menu ‚Üí "Add to Home screen" 3. Confirm installation ### Mobile (iOS) 1. Visit app URL in Safari 2. Tap Share button 3. Tap "Add to Home Screen" --- ## üîí Security & Privacy ### Data Encryption All referral data is encrypted at rest using AES-GCM with device-derived keys. See `src/lib/crypto.ts`. ### PHI Handling * **Local-only**: No PHI transmitted to servers by default * **Optional Sync**: User must explicitly opt-in to cloud sync * **Audit Logging**: All actions logged locally ### Content Security Policy Strict CSP headers prevent XSS and code injection. See `index.html`. --- ## üìÑ Export Formats ### PDF Export Generates formatted PDF with: * Patient demographics (if provided) * Specialty and acuteness * Clinical summary * Reason for referral * Confidence score ### FHIR Export Generates FHIR R4 `ReferralRequest` resource: ```json { "resourceType": "ReferralRequest", "id": "...", "status": "draft", "intent": "proposal", "priority": "routine", "reasonCode": [{ "text": "..." }], "description": "..." } ``` --- ## üåç Internationalization ### Supported Languages * **English** (en) * **Arabic** (ar) with RTL support ### Adding Languages 1. Add language option to UI (`src/components/ReferralGenerator.tsx`) 2. Update prompt templates in `src/lib/wasm-runtime.ts` 3. Ensure STT model supports language 4. Add translations for UI strings --- ## üõ†Ô∏è Configuration ### Model Registry URL Update CDN URL in `src/lib/model-manager.ts`: ```typescript const MODEL_REGISTRY_URL = 'https://your-cdn.com/models'; ``` ### Device Capability Thresholds Adjust model selection logic in `src/lib/capabilities.ts`: ```typescript if (caps.availableMemoryGB >= 4) { return 'llm-medium-q4'; } ``` ### Storage Limits Configure cache sizes in `vite.config.ts`: ```typescript maximumFileSizeToCacheInBytes: 100 * 1024 * 1024 // 100MB ``` --- ## üìä Monitoring ### Error Tracking Integrate Sentry or similar: ```typescript // src/main.tsx import * as Sentry from '@sentry/react'; Sentry.init({ dsn: 'YOUR_DSN', environment: 'production' }); ``` ### Analytics Use privacy-preserving analytics (Plausible, Fathom): ```html <!-- index.html --> <script defer data-domain="yourdomain.com" src="https://plausible.io/js/script.js"></script> ``` --- ## ü§ù Contributing Contributions welcome! Please read [CONTRIBUTING.md](CONTRIBUTING.md) first. ### Development Workflow 1. Fork repository 2. Create feature branch (`git checkout -b feature/amazing-feature`) 3. Commit changes (`git commit -m 'Add amazing feature'`) 4. Push to branch (`git push origin feature/amazing-feature`) 5. Open Pull Request --- ## üìú License This project is licensed under the MIT License - see [LICENSE](LICENSE) file. ### Model Licenses Models have separate licenses. See [LICENSES.md](LICENSES.md) for details: * **TinyLlama**: Apache-2.0 * **Whisper**: MIT * **Llama-2**: Meta Llama 2 Community License (download-only) --- ## üôè Acknowledgments * [llama.cpp](https://github.com/ggerganov/llama.cpp) - WASM LLM runtime * [whisper.cpp](https://github.com/ggerganov/whisper.cpp) - WASM STT runtime * [Workbox](https://developers.google.com/web/tools/workbox) - Service worker library * [jsPDF](https://github.com/parallax/jsPDF) - PDF generation * [idb](https://github.com/jakearchibald/idb) - IndexedDB wrapper --- ## üìû Support * **Documentation**: [docs/](docs/) * **Issues**: [GitHub Issues](https://github.com/your-org/clinical-referral-pwa/issues) * **Email**: [support@example.com](mailto:support@example.com) --- ## üó∫Ô∏è Roadmap * $$ $$ Multi-patient batch processing * $$ $$ Integration with EHR systems (HL7 FHIR) * $$ $$ Voice commands for hands-free operation * $$ $$ Specialty-specific templates * $$ $$ Collaborative editing (encrypted sync) * $$ $$ Mobile app wrappers (Capacitor) * $$ $$ Desktop app (Tauri) --- **Built with ‚ù§Ô∏è for healthcare professionals**